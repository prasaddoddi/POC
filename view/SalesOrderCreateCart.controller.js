/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("sap.ui.core.mvc.Controller");jQuery.sap.require("cus.sd.salesorder.create.util.ModelUtils");jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("cus.sd.salesorder.create.util.Utils");jQuery.sap.require("cus.sd.salesorder.create.util.Validator");sap.ca.scfld.md.controller.BaseFullscreenController.extend("cus.sd.salesorder.create.view.SalesOrderCreateCart",{validator:null,onInit:function(){sap.ca.scfld.md.controller.BaseFullscreenController.prototype.onInit.call(this);this.oRouter.attachRouteMatched(function(e){if(e.getParameter("name")==="soCreateCart"){this.getView().setModel(this.oApplicationFacade.getApplicationModel("soc_cart"),"soc_cart");this.getView().updateBindings();this.validator=new cus.sd.salesorder.create.util.Validator();}},this);},removeItem:function(e){var b=e.getSource();var l=b.getParent();var p=l.getBindingContext("soc_cart").getPath();var i=parseInt(p.substring(p.lastIndexOf('/')+1));var d=4;var a=l.getCells()[d];this.validator.unregisterInvalidControl(a.getId());cus.sd.salesorder.create.util.ModelUtils.deleteCartItemAtIndex(i);},setUniformRDD:function(e){var d=e.getSource();var D=e.getParameter("newYyyymmdd");if(D===null){d.setValueState("Error");this.validator.registerInvalidControl(d.getId());}else{d.getModel("soc_cart").setProperty("RDD",D,d.getBindingContext("soc_cart"));d.setValueState("None");this.validator.unregisterInvalidControl(d.getId());}},setUniformSingleRdd:function(e){var d=e.getSource();var D=e.getParameter("newYyyymmdd");if(D===null){d.setValueState("Error");this.validator.registerInvalidControl(d.getId());}else{this.getView().getModel("soc_cart").setProperty("/singleRdd",D);d.setValueState("None");this.validator.unregisterInvalidControl(d.getId());}},onATPCheck:function(){if(this.validator.getInvalidControlsNumber()===0){this.oRouter.navTo("quickCheckout",{});}else{sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("MISSING_INVALID"),sap.m.MessageBox.Icon.ERROR,this.getView().getModel("i18n").getProperty("MISSING_TITLE"),[sap.m.MessageBox.Action.OK]);}},_onNavigateHome:function(){window.history.go(-1);},onNumberEnter:function(e){var t=e.getParameters().newValue;if(t.indexOf("-")!==-1){var r=t.replace("-","");e.getSource().setValue(r);}if(!this.isNumberFieldValid(t)){e.getSource().setValueState(sap.ui.core.ValueState.Error);this.validator.registerInvalidControl(e.getSource().getId());}else{e.getSource().setValueState(sap.ui.core.ValueState.None);this.validator.unregisterInvalidControl(e.getSource().getId());}},getHeaderFooterOptions:function(){var b=[];b.push({sI18nBtnTxt:"CHECKOUT",onBtnPressed:jQuery.proxy(this.onATPCheck,this)});return{sI18NFullscreenTitle:"CART",buttonList:b,onBack:jQuery.proxy(this._onNavigateHome,this),bSuppressBookmarkButton:true};},isNumberFieldValid:function(t){var n=t.replace(/ +/,'');var i=/^\d+$/.test(n);return i;}});
